{
  "name": "kilted desktop-full dev container",
  // non root
  "remoteUser": "user",
  // for permissions
  "updateRemoteUserUID": true,
  "build": {
    "dockerfile": "Dockerfile",
    "target": "dev",
    "context": ".."
  },
  "runArgs": [
    // host namespace
    "--privileged",
    "--network=host", "--pid=host", "--ipc=host", "--uts=host",
    "--init",
    // nvidia
    "--gpus=all",
    "-e", "NVIDIA_VISIBLE_DEVICES=all",
    "-e", "NVIDIA_DRIVER_CAPABILITIES=all",
    // GUI
    "-v", "/tmp/.X11-unix:/tmp/.X11-unix",
    "-e", "DISPLAY=${localEnv:DISPLAY}",
    "-e", "QT_X11_NO_MITSHM=1",
    // docker CLI in container
    "-v", "/var/run/docker.sock:/var/run/docker.sock"
  ],
  "workspaceMount": "source=${localWorkspaceFolder},target=/${localWorkspaceFolderBasename},type=bind",
  "workspaceFolder": "/${localWorkspaceFolderBasename}",
  "mounts": [
    "source=${localEnv:HOME}/.bash_history,target=/home/user/.bash_history,type=bind"
  ],
  "containerEnv": {
        "ROS_AUTOMATIC_DISCOVERY_RANGE": "LOCALHOST",
        "ROS_DOMAIN_ID": "42",
        "__GLX_VENDOR_LIBRARY_NAME": "nvidia"
  },
  "customizations": {
        "vscode": {
            "extensions":[
                "batisteo.vscode-django",
                "charliermarsh.ruff",
                "donjayamanne.python-environment-manager",
                "donjayamanne.python-extension-pack",
                "eamodio.gitlens",
                "kevinrose.vsc-python-indent",
                "ms-python.debugpy",
                "ms-python.python",
                "ms-python.vscode-pylance",
                "ms-python.vscode-python-envs",
                "ms-vscode.cpptools",
                "ms-vscode.cpptools-themes",
                "njpwerner.autodocstring",
                "openai.chatgpt",
                "twxs.cmake",
                "visualstudioexptteam.intellicode-api-usage-examples",
                "visualstudioexptteam.vscodeintellicode",
                "wholroyd.jinja"
            ],
            "settings": {
                "terminal.integrated.shellArgs.linux": [ "-lc", "tmux new -ADs dev" ],
                "terminal.integrated.profiles.linux": {
                    "tmux": {
                        "path": "tmux",
                        "args": ["new-session", "-A", "-s", "vscode:${workspaceFolder}"]
                    }
                }
            }
        }
    },
    "postCreateCommand": "bash -lc 'set -e; sed -i \"s/\\r$//\" .devcontainer/bootstrap.sh; chmod 755 .devcontainer/bootstrap.sh;'",
    "postStartCommand": "bash -lc '.devcontainer/bootstrap.sh'"
}
